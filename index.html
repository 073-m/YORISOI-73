<!DOCTYPE html>
<html>
<head>

    <title>YORISOI73</title>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.x/dist/aframe-particle-system-component.min.js"></script>
    


    <!--‚òÖ‚òÖ‚òÖ„ÄÄÂ∑¶‰∏äUI„ÄÄ‚òÖ‚òÖ‚òÖ-->
    <style>

        body { margin: 0; overflow: hidden; }
        #ui {
            position: absolute; top: 15px; left: 15px;
            z-index: 1000;
            background: rgba(42, 42, 42, 0.7);
            color: white; padding: 10px;
            border-radius: 10px;
            font-family: sans-serif;
        }
        input[type="file"]
        { width: 220px; padding: 2px; }
        button
        { padding: 6px 8px; margin: 1px; } 

    </style>



    <script>
        //„ÄÄ‚òÖ‚òÖ‚òÖ„ÄÄÊòüÁ©∫„ÄÄ‚òÖ‚òÖ‚òÖ
        AFRAME.registerComponent('starry-sky', {
            schema: {
                count: {type: 'number', default: 700},
                radius: {type: 'number', default: 90}
            },

            init: function (){
                const el = this.el;
                const data = this.data;
                for (let i = 0; i < data.count; i++) {
                    const star = document.createElement('a-sphere');
                    star.setAttribute('radius', Math.random() * 0.05 + 0.02);
                    star.setAttribute('color', '#FFFFFF');

                    // Êòü„ÅÆÁô∫ÂÖâ
                    star.setAttribute('material', 'shader: flat; emissive: #FFFFFF; emissiveIntensity: 1.0;');
                
                    const u = Math.random();
                    const v = Math.random();
                    const theta = 2 * Math.PI * u;
                    const phi = Math.acos(2 * v - 1);
                    const x = data.radius * Math.sin(phi) * Math.cos(theta);
                    const y = data.radius * Math.sin(phi) * Math.sin(theta);
                    const z = data.radius * Math.cos(phi);
                    star.setAttribute('position', `${x} ${y} ${z}`);
                    el.appendChild(star);
                }
            }
        });
        


        //„ÄÄ‚òÖ‚òÖ‚òÖ„ÄÄÈõ®„ÄÄ‚òÖ‚òÖ‚òÖ
        AFRAME.registerComponent('rain', {
            schema: {
                count: {type: 'number', default: 500},
                area: {type: 'number', default: 30},
                roomDepth: {type: 'number', default: 6.5}
            },

            init: function () {
                const el = this.el;
                const data = this.data;
                for (let i = 0; i < data.count; i++) {
                    const rainDrop = document.createElement('a-box');
                    rainDrop.setAttribute('color', '#ADD8E6');
                    rainDrop.setAttribute('width', 0.01);
                    rainDrop.setAttribute('height', 0.15);
                    rainDrop.setAttribute('depth', 0.01);
                
                    let x, y, z;
                
                    do {
                        x = Math.random() * data.area - data.area / 2;
                        z = Math.random() * data.area - data.area / 2;
                    } while (x > -3 && x < 3 && z > -3 - data.roomDepth / 2 && z < -3 + data.roomDepth / 2);
                    y = Math.random() * 10 + 10;
                
                    rainDrop.setAttribute('position', `${x} ${y} ${z}`);
                    rainDrop.setAttribute('animation__fall', {
                        property: 'position',
                        to: `${x} 0 ${z}`,
                        dur: Math.random() * 1500 + 1500,
                        loop: true,
                        easing: 'linear'
                    });
                    el.appendChild(rainDrop);
                }
            }
        });



        //„ÄÄ‚òÖ‚òÖ‚òÖ„ÄÄÊôÇË®à„ÄÄ‚òÖ‚òÖ‚òÖ
        AFRAME.registerComponent('clock', {

            init: function () {
                // Á©∫„Å®Êòü„ÅÆË¶ÅÁ¥†„ÇíË¶ã„Å§„Åë„Çã
                this.skyEl = document.getElementById('sky-element');
                this.starsEl = document.getElementById('stars-element');
            },

            tick: function () {
                const el = this.el;
                const now = new Date();

                // ÊôÇË®à
                const jst_time = now.toLocaleString("ja-JP", {
                    timeZone: "Asia/Tokyo",
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });

                // Êó•‰ªò
                const jst_date = now.toLocaleString("ja-JP",{
                    timeZone: "Asia/Tokyo",
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });

                // ÊõúÊó•
                const jst_weekday = now.toLocaleString("en-US",{
                    timeZone: "Asia/Tokyo",
                    weekday: 'long'
                });

                const display_text = jst_time + '\n' + jst_date + ' ' + jst_weekday
                el.setAttribute('value', display_text);

                // Á©∫„ÅÆËâ≤Âà∂Âæ°
                const hour = now.getHours();            // ÊôÇÈñì„ÅÆÊÉÖÂ†±ÂèñÂæó
                let skyColor = "#212133";               // „Éá„Éï„Ç©„É´„Éà
                let starsVisible = true;

                if (hour >= 6 && hour < 10) {           // Êúù (6ÊôÇ„Äú9ÊôÇÂè∞)
                    skyColor = "#87CEEB";               // Êòé„Çã„ÅÑÁ©∫Ëâ≤
                    starsVisible = false;
                }
                
                else if (hour >= 10 && hour < 16) {   // Êòº (10ÊôÇ„Äú15ÊôÇÂè∞)
                    skyColor = "#4682B4";„ÄÄ„ÄÄ„ÄÄ         // ÊøÉ„ÅÑÁ©∫Ëâ≤
                    starsVisible = false;
                }
                
                else if (hour >= 16 && hour < 19) {„ÄÄ„ÄÄ// Â§ïÊñπ (16ÊôÇ„Äú18ÊôÇÂè∞)
                    skyColor = "#FF7F50";                // Â§ïÁÑº„ÅëËâ≤
                    starsVisible = true;
                }
                
                else {                                // Â§ú (19ÊôÇ„ÄúÁøå5ÊôÇÂè∞)
                    skyColor = "#212133";                // „Éá„Éï„Ç©„É´„Éà„ÅÆÂ§ú„ÅÆËâ≤
                    starsVisible = true;
                }

                // ÂèñÂæó„Åó„ÅüÁ©∫„Å®Êòü„Å´„ÄÅËâ≤„Å®Ë°®Á§∫Áä∂ÊÖã„ÇíÈÅ©Áî®„Åï„Åõ„Çã
                if (this.skyEl) {
                    this.skyEl.setAttribute('color', skyColor);
                }
                if (this.starsEl) {
                    this.starsEl.setAttribute('visible', starsVisible);
                }
            }
        });



        //„ÄÄ‚òÖ‚òÖ‚òÖ„ÄÄÈõ®Èü≥Âà∂Âæ°„ÄÄ‚òÖ‚òÖ‚òÖ
        AFRAME.registerComponent('audio-control', {
            init: function () {
                const audioEl = document.getElementById('rain-audio');
                audioEl.volume = 1.0;
                this.el.sceneEl.addEventListener('enter-vr', function () { audioEl.play(); });
            }
        });



        //„ÄÄ‚òÖ‚òÖ‚òÖ„ÄÄ„É©„Ç§„Éà„Çπ„Ç§„ÉÉ„ÉÅ„ÄÄ‚òÖ‚òÖ‚òÖ
        AFRAME.registerComponent('light-switch', {
            init: function () {
                const lightEl = document.getElementById('room-light');
                const switchEl = this.el;

                let lightIsOn = true;

                if (lightEl) {
                    switchEl.addEventListener('click', function () {
                        if (lightIsOn) {
                            lightEl.setAttribute('light', 'intensity', 0.09); // OFF
                        }
                        else {
                            lightEl.setAttribute('light', 'intensity', 0.5); // ON (ÂÖÉ„ÅÆÊòé„Çã„Åï)
                        }
                        lightIsOn = !lightIsOn;
                    });
                }
            }
        });



        //„ÄÄ‚òÖ‚òÖ‚òÖ„ÄÄÈõ®Èü≥„Çπ„Ç§„ÉÉ„ÉÅ„ÄÄ‚òÖ‚òÖ‚òÖ
        AFRAME.registerComponent('rain-switch', {
            init: function () {
                const audioEl = document.getElementById('rain-audio');
                const visualEl = document.getElementById('rain-visual');„ÄÄ// Èõ®„ÅÆË¶ã„ÅüÁõÆ
                const switchEl = this.el;
                let isPlaying = true;

                switchEl.addEventListener('click', function () {
                    if (isPlaying) {
                        // Èõ®„ÇíÊ≠¢„ÇÅ„ÇãÂá¶ÁêÜ
                        audioEl.pause();
                        visualEl.setAttribute('visible', false);„ÄÄ// Èõ®ÈùûË°®Á§∫
                    }
                    else {
                        // Èõ®ÂÜçÁîü„Åô„ÇãÂá¶ÁêÜ
                        audioEl.play();
                        visualEl.setAttribute('visible', true);
                    }
                    isPlaying = !isPlaying;
                });
            }
        });



        //„ÄÄ‚òÖ‚òÖ‚òÖ„ÄÄÂãïÁîªÂÜçÁîü„ÄÄ‚òÖ‚òÖ‚òÖ
        AFRAME.registerComponent('user-video-control', {
            init: function() {
                const videoEl = document.getElementById('user-video-texture'); 
                const fileInput = document.getElementById('video-file-input');
                const playButton = document.getElementById('video-play-button');
                const stopButton = document.getElementById('video-stop-button');

                fileInput.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        const fileURL = URL.createObjectURL(file);
                        videoEl.src = fileURL;
                        videoEl.load();
                        videoEl.play();
                    }
                });

                playButton.addEventListener('click', () => {
                    videoEl.play();
                });

                stopButton.addEventListener('click', () => {
                    videoEl.pause();
                });
            }
        });



        //„ÄÄ‚òÖ‚òÖ‚òÖ„ÄÄÊ§ÖÂ≠ê„Å®„Éô„ÉÉ„Éâ„Å´„ÉÜ„É¨„Éù„Éº„Éà„ÄÄ‚òÖ‚òÖ‚òÖ
        AFRAME.registerComponent('teleport-on-click', {
            schema: {
                // 'targetPos' „Å®„ÅÑ„ÅÜÂêçÂâç„Åß„ÄÅÁßªÂãïÂÖà„ÅÆÂ∫ßÊ®ô„ÇíÂèó„ÅëÂèñ„Çã
                targetPos: {type: 'vec3', default: {x: 0, y: 0, z: 0}}
            },
            init: function () {
                const cameraRig = document.getElementById('cameraRig');
                
                this.el.addEventListener('click', () => {
                    // Áû¨ÊôÇ„Å´ÁßªÂãï
                    cameraRig.setAttribute('position', this.data.targetPos);
                });
            }
        });



        //„ÄÄ‚òÖ‚òÖ‚òÖ„ÄÄÁßªÂãï„Åô„Çã„ÄÄ‚òÖ‚òÖ‚òÖ
        AFRAME.registerComponent('click-to-move', {
            init: function () {
                const el = this.el;
                const cameraRig = document.getElementById('cameraRig');

                el.addEventListener('click', (evt) => {
                    const intersection = evt.detail.intersection.point;

                    const targetPosition = {
                        x: intersection.x,
                        y: 0,
                        z: intersection.z
                    };

                    cameraRig.setAttribute('animation', {
                        property: 'position',
                        to: `${targetPosition.x} ${targetPosition.y} ${targetPosition.z}`,
                        dur: 1000,
                        easing: 'easeInOutQuad'
                    });
                });
            }
        });



        // ‚òÖ‚òÖ„ÄÄ„Ç´„É©„ÉºÂ§âÊõ¥„Çπ„Ç§„ÉÉ„ÉÅÊ©üËÉΩ
        AFRAME.registerComponent('color-switch', {
            // 3„Å§„ÅÆËâ≤„ÅÆ„ÉÜ„Éº„Éû
            themes: [
                { floor: '#2f5d50', wall: '#3b7960', furnitureA: '#98605e', furnitureB: '#c0c0c0' }, // (Á∑ë)
                { floor: '#6b4f34', wall: '#8b6b49', furnitureA: '#b08a5b', furnitureB: '#f0e68c' }, // (Ê©ô)
                { floor: '#4a4266', wall: '#5c527f', furnitureA: '#7f78a0', furnitureB: '#a9a2c4' }  // (Á¥´)
            ],

            init: function () {
                this.currentTheme = 0; // ÁèæÂú®„ÅÆ„ÉÜ„Éº„ÉûÁï™Âè∑
                this.elements = { // Ëâ≤„ÇíÂ§â„Åà„ÇãË¶ÅÁ¥†„Çí„Åô„Åπ„Å¶Êé¢„Åó„Å¶„Åä„Åè
                    floor: document.querySelectorAll('.themable-floor'),
                    wall: document.querySelectorAll('.themable-wall'),
                    furnitureA: document.querySelectorAll('.themable-furnitureA'),
                    furnitureB: document.querySelectorAll('.themable-furnitureB'),
                    desk: document.querySelector('.themable-desk')
                };

                // „Éá„Éï„Ç©„É´„Éà„ÇíÈÅ©Áî®
                this.applyTheme();

                // „Çπ„Ç§„ÉÉ„ÉÅ„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„ÅüÊôÇ
                this.el.addEventListener('click', () => {
                    // Ê¨°„ÅÆ„ÉÜ„Éº„ÉûÁï™Âè∑„Å´ÈÄ≤„ÇÅ„Çã
                    this.currentTheme = (this.currentTheme + 1) % this.themes.length;
                    // Ëâ≤„ÇíÈÅ©Áî®„Åô„Çã
                    this.applyTheme();
                });
            },

            // Ëâ≤„ÇíÈÅ©Áî®„Åô„ÇãÈñ¢Êï∞
            applyTheme: function () {
                const theme = this.themes[this.currentTheme];
                this.elements.floor.forEach(el => el.setAttribute('color', theme.floor));
                this.elements.wall.forEach(el => el.setAttribute('color', theme.wall));
                this.elements.furnitureA.forEach(el => el.setAttribute('color', theme.furnitureA));
                this.elements.furnitureB.forEach(el => el.setAttribute('color', theme.furnitureB));

                // Êú∫(ÁâπÂà•)
                if (this.elements.desk) {
                    this.elements.desk.setAttribute('material', {
                        color: theme.desk,
                        opacity: 0.8, // ÈÄèÊòéÂ∫¶
                        transparent: true
                    });
                }
            }
        });



        // ‚òÖ‚òÖ‚òÖ ÂÖâ„ÇãË¶≥ËëâÊ§çÁâ© ‚òÖ‚òÖ‚òÖ
        AFRAME.registerComponent('plant-light-switch', {
            init: function () {
                const lightSource = document.getElementById('plant-light-source');
                const plantSphere = document.getElementById('glowing-plant-sphere');
                let isPlantOn = false;

                this.el.addEventListener('click', () => {
                    if (isPlantOn) {
                        lightSource.setAttribute('light', 'intensity', 0);
                        plantSphere.setAttribute('material', 'emissiveIntensity', 0.2);
                    }
                    else {
                        lightSource.setAttribute('light', 'intensity', 1.5);
                        plantSphere.setAttribute('material', 'emissiveIntensity', 1.0);
                    }
                    isPlantOn = !isPlantOn;
                });
            }
        });

    </script>
</head>



<body>

    <div id="ui">
        <div>üéûÔ∏è‚≠ê ÂãïÁîª„ÇíÂÜçÁîü ‚≠êüéûÔ∏è</div>
        <input type="file" id="video-file-input" accept="video/mp4,video/webm">
        <button id="video-play-button"> ‚ñ∂Ô∏èÂÜçÁîü </button>
        <button id="video-stop-button"> ‚è∏Ô∏èÂÅúÊ≠¢ </button>
    </div>



    <a-scene audio-control user-video-control>
    
        <a-assets>
            <video id="user-video-texture" src="" autoplay="false" loop="true" crossorigin="anonymous"></video>
            <audio id="rain-audio" src="rain.mp3" loop></audio>
        </a-assets>


        <a-entity id="cameraRig" position="0 0 -2.0" wasd-controls="acceleration: 10">
            
            <a-entity id="head" camera look-controls position="0 1.6 0"></a-entity>

            <a-entity laser-controls="hand: left" raycaster="objects: .clickable; far: 10" line="color: white; opacity: 0.5"></a-entity>
            <a-entity laser-controls="hand: right" raycaster="objects: .clickable; far: 10" line="color: white; opacity: 0.5"></a-entity>

            <a-entity cursor="rayOrigin: mouse" raycaster="objects: .clickable"></a-entity>
            
        </a-entity>


        <a-light id="room-light" type="ambient" color="#fff" intensity="0.5"></a-light>


        <a-sky
            id="sky-element"
            color="#212133"
            material="shader: flat;">
        </a-sky>


        <a-entity
            id="stars-element"
            starry-sky="count: 700; radius: 90;">
        </a-entity>


        <a-entity
            id="rain-visual"
            rain="count: 500; area: 20; roomDepth: 6.5;">
        </a-entity>


        <a-box
            position="0 0 -3"
            width="6" height="0.1" depth="6"
            class="themable-floor clickable"
            click-to-move>
        </a-box>
        
        <a-box
            position="0 3 -3"
            width="6" height="0.1" depth="6"
            material="color: #ADD8E6; opacity: 0.3; transparent: true;">
        </a-box>
        <a-box
            position="0 1.5 -6"
            width="6" height="3" depth="0.1"
            class="themable-wall">
        </a-box>
        <a-box
            position="-3 1.5 -3"
            width="0.1" height="3" depth="6"
            class="themable-floor">
        </a-box>
        <a-box
            position="3 1.5 -3"
            width="0.1" height="3" depth="6"
            class="themable-floor">
        </a-box>
        <a-box
            position="0 1.5 0"
            width="6" height="3" depth="0.1"
            class="themable-wall">
        </a-box>


        <a-box
            id="bed"
            position="-1.8 0.2 -1.5"
            width="2"
            height="0.5"
            depth="2.8"
            color="#98605e"
            class="clickable"
            teleport-on-click="targetPos: -1.8 0 -1.5">
        </a-box>


        <a-box
            id="makura"
            position="-1.8 0.5 -2.5"
            width="1.5"
            height="0.3"
            depth="0.5"
            color="#c0c0c0">
        </a-box>
    

        <a-text
            id="clock-text"
            value="00:00:00"
            position="0.6 0.4 -5.85"
            width="4.0"
            color="#7a9990"
            clock>
        </a-text>


        <a-box
            id="table"
            position="0.0 0.0 -4.5"
            width="3.0"
            height="1.0"
            depth="1"
            material="opacity: 0.8; transparent: true;"
            class="themable-desk">
        </a-box>


        <a-box
            id="chair"
            position="0 0.1 -4.0"
            width="2.0" height="0.5" depth="0.05"
            color="#5b7e91" 
            rotation="-90 0 0"
            class="clickable"
            teleport-on-click="targetPos: 0.0 0 -3.9">
        </a-box>


        <a-box id="light-switch" position="2.5 1.3 -5.9" width="0.1" height="0.15" depth="0.08" color="d2b48c" light-switch class="clickable"></a-box>
        <a-text value="LIGHT | on/off |" position="2.5 1.5 -5.9" width="1.5" color="#c0c0c0" align="center"></a-text>


        <a-entity position="2.5 0 -0.7">

            <a-cylinder
                radius="0.3" height="1"
                color="#856859">
            </a-cylinder>

            <a-sphere

                id="glowing-plant-sphere" 
                position="0 0.9 0" 
                radius="0.3" 
                color="#769164" 
                material="emissive: #769164; emissiveIntensity: 0.2"
                class="clickable"
                plant-light-switch>

                <a-light
                    id="plant-light-source"
                    type="point"
                    color="#a3d6cc"
                    intensity="0"
                    position="0 0.9 0">
                </a-light>

            </a-sphere>
        </a-entity>


        <a-box id="rain-switch" position="2.5 1.1 -5.9" width="0.1" height="0.15" depth="0.08" color="#84a2d4" rain-switch class="clickable"></a-box>
        <a-text value="RAIN | on/off |" position="2.5 0.95 -5.9" width="1.5" color="#c0c0c0" align="center"></a-text>


        <a-box id="color-switch" position="2.5 0.7 -5.9" width="0.1" height="0.15" depth="0.08" color="#f0e68c" color-switch class="clickable"></a-box>
        <a-text value="Color | change |" position="2.5 0.55 -5.9" width="1.5" color="#c0c0c0" align="center"></a-text>


        <a-plane
            id="videoScreen"
            geometry="primitive: plane; height: 2.2; width: 3.7"
            position="0 1.7 -5.9"
            material="src: #user-video-texture; side: double;">
        </a-plane>


        <a-entity id="forest-area">

            <a-entity position="0 0 -10">
                <a-entity position="-8 0 0" scale="1.5 1.5 1.5"> <a-cylinder color="#5D4037" radius="0.2" height="3"></a-cylinder>
                    <a-cone color="#2f5d50" radius-bottom="1" height="4" position="0 3 0"></a-cone> </a-entity>
                <a-entity position="-4 0 -2" scale="1 1 1"> <a-cylinder color="#5D4037" radius="0.2" height="2"></a-cylinder>
                    <a-cone color="#3b7960" radius-bottom="0.8" height="3" position="0 2 0"></a-cone> </a-entity>
                <a-entity position="0 0 1" scale="1.8 1.8 1.8"> <a-cylinder color="#5D4037" radius="0.2" height="4"></a-cylinder>
                    <a-cone color="#2f5d50" radius-bottom="0.8" height="3" position="0 2 0"></a-cone> </a-entity>
                <a-entity position="5 0 -1" scale="1.2 1.2 1.2"> <a-cylinder color="#5D4037" radius="0.2" height="2.5"></a-cylinder>
                    <a-cone color="#3b7960" radius-bottom="1" height="3.5" position="0 2.5 0"></a-cone> </a-entity>
                <a-entity position="9 0 0" scale="1.5 1.5 1.5"> <a-cylinder color="#5D4037" radius="0.2" height="3"></a-cylinder>
                    <a-cone color="#2f5d50" radius-bottom="1" height="4" position="0 3 0"></a-cone> </a-entity>
            </a-entity>
            <a-entity position="-10 0 0" rotation="0 90 0">
                <a-entity position="-5 0 0" scale="1.5 1.5 1.5"> <a-cylinder color="#5D4037" radius="0.2" height="3"></a-cylinder>
                    <a-cone color="#2f5d50" radius-bottom="1" height="4" position="0 3 0"></a-cone> </a-entity>
                <a-entity position="0 0 1" scale="1.8 1.8 1.8"> <a-cylinder color="#5D4037" radius="0.2" height="4"></a-cylinder>
                    <a-cone color="#2f5d50" radius-bottom="1.2" height="5" position="0 4 0"></a-cone> </a-entity>
                <a-entity position="4 0 -1" scale="1.2 1.2 1.2"> <a-cylinder color="#5D4037" radius="0.2" height="2.5"></a-cylinder>
                    <a-cone color="#3b7960" radius-bottom="1" height="3.5" position="0 2.5 0"></a-cone> </a-entity>
            </a-entity>
            <a-entity position="10 0 0" rotation="0 -90 0">
                <a-entity position="-6 0 0" scale="1.5 1.5 1.5"> <a-cylinder color="#5D4037" radius="0.2" height="3"></a-cylinder>
                    <a-cone color="#2f5d50" radius-bottom="1" height="4" position="0 3 0"></a-cone> </a-entity>
                <a-entity position="-1 0 1" scale="1.8 1.8 1.8"> <a-cylinder color="#5D4037" radius="0.2" height="4"></a-cylinder>
                    <a-cone color="#2f5d50" radius-bottom="1.2" height="5" position="0 4 0"></a-cone> </a-entity>
                <a-entity position="3 0 -1" scale="1.2 1.2 1.2"> <a-cylinder color="#5D4037" radius="0.2" height="2.5"></a-cylinder>
                    <a-cone color="#3b7960" radius-bottom="1" height="3.5" position="0 2.5 0"></a-cone> </a-entity>
            </a-entity>
        </a-entity>


        <a-plane 
            position="0 -0.05 0" 
            rotation="-90 0 0" 
            width="20" height="20" 
            color="#384e36"
            class="clickable"
            click-to-move>
        </a-plane>
    </a-scene>

</body>
</html>
